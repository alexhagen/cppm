<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cppm &#8212; cppm a documentation</title>
    
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/extra.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ah_shm Documentation" href="ah_shm.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>



<div id="navbar" class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">
        cppm</a>
      <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
    </div>

      <div class="collapse navbar-collapse nav-collapse">
        <ul class="nav navbar-nav">
          
            <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">C++- Docs <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="ah_shm.html">ah_shm Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ah_value.html">ah_value Documentation</a></li>
</ul>
</ul>
</li>
            
              <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#"> <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">cppm</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#memory-objects">Memory Objects</a></li>
<li><a class="reference internal" href="#tcp-objects">TCP Objects</a></li>
<li><a class="reference internal" href="#udp-objects">UDP Objects</a></li>
<li><a class="reference internal" href="#signals-and-timing">Signals and Timing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
            
          
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
          
          
          
          
          
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://alexhagen.github.io/" target="_blank">Alex Hagen</a></li>
        </ul>
      </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="cppm">
<h1>cppm<a class="headerlink" href="#cppm" title="Permalink to this headline">¶</a></h1>
<p><strong>c++ objects for people with no time</strong></p>
<p>I write a lot of firmware for the detectors I make. And I have to say,
<code class="docutils literal"><span class="pre">c++</span></code> has some of the most convoluted classes imaginable. So,
everytime I have to use one of the complex <code class="docutils literal"><span class="pre">c++</span></code> objects, or - even
worse - use the old non-semantic <code class="docutils literal"><span class="pre">c</span></code> APIs for things, I try to write
it into a little bit more pythonic object. If you really want the full
power of these objects, don’t use this library. But if you want the
object to be exactly what it says it is, and no more, this library may
be one of the faster ways.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Installation is easy. Just clone, copy into <code class="docutils literal"><span class="pre">/usr/inclue/c++</span></code>, and go.
If you’re on Windows, good luck. Maybe someone can tell me where Windows
developers might keep their header files.</p>
<p><strong>Step-By-Step</strong></p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">alexhagen</span><span class="o">/</span><span class="n">cppm</span>
<span class="n">cp</span> <span class="n">cppm</span><span class="o">/*.</span><span class="n">h</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">includes</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>There’s a bunch of different interfaces defined here, categorized
roughly as <em>memory objects</em>, <em>tcp objects</em>, <em>udp objects</em>, and <em>signals
and timing</em>. Specific documentation on all of those interfaces are
included in the readmes folder.</p>
</div>
<div class="section" id="memory-objects">
<h2>Memory Objects<a class="headerlink" href="#memory-objects" title="Permalink to this headline">¶</a></h2>

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="shm---Shared-Memory">shm - Shared Memory<a class="anchor-link" href="#shm---Shared-Memory">&#182;</a></h3><p>I created this shared memory interface to pass variables amongst processes in linux for a detector firmware I was writing.  It uses the <code>shmget</code> and <code>shmat</code> C interface under the hood, but that's all so non-semantic when you code it that you shouldn't have to worry about it.</p>
<h4 id="Example">Example<a class="anchor-link" href="#Example">&#182;</a></h4><p>My fiance is watching the tv show Sherlock Holmes behind me, so this example is themed on that show.</p>
<p>First, we have to create some server for the shared memory.  This server has to be open for the client process to read it, so we'll just keep it open indefinitely.  We also have to define a unique identifier for the shared memory server.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">cppm</span> <span class="kn">import</span> <span class="n">cppmagic</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">runcppnb</span> shm_server
#include &quot;../ah_shm.h&quot;
#include &quot;../ah_signal.h&quot;
#include &lt;string&gt;

int run = 1;

void cleanup(int signum){
    run = 0;
}

int main(void){
    // create the shm server
    shm_server&lt;std::string&gt; *sherlock = new shm_server&lt;std::string&gt;(5678);
    // latch a cleanup function onto the SIGTERM signal
    ah_signal(SIGTERM, &amp;cleanup);

    while (run){
        sherlock-&gt;set(&quot;is a good guy!&quot;);
        sleep(1);
        sherlock-&gt;set(&quot;is a bad guy!&quot;);
        sleep(1);
        sherlock-&gt;set(&quot;is dead!&quot;);
        sleep(1);
        sherlock-&gt;set(&quot;is now alive again!&quot;);
        sleep(1);
    }
    
    delete sherlock;
    return 0;
}
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, to connect to the memory.  We have to attach using the same key, which is a little bit of a paint, but if you use macros effectively, it'll just be like pointing at a file.  This client will be way faster than using files though, for time intensive processes, use these <code>shm</code>s.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">runcpp</span> shm_client
#include &quot;../ah_shm.h&quot;
#include &lt;string&gt;

int main(void){
    shm_client&lt;std::string&gt; *holmes = new shm_client&lt;std::string&gt;(5678);
    for(int i=1; i&lt;5; i++){
        const char* desc = holmes-&gt;get().c_str();
        printf(&quot;Episode %d in which Sherlock %s\n&quot;, i, desc);
        sleep(1);
    }
    delete holmes;
    return 0;
}
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Episode 1 in which Sherlock is a good guy!
Episode 2 in which Sherlock is a bad guy!
Episode 3 in which Sherlock is dead!
Episode 4 in which Sherlock is now alive again!

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we just have to stop the server to make sure we're not leaving too many things open.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">killall</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Just a note:  I'm still working on the cleanup of this.  To check that I've removed all of the attached shared memory, you can use the bash line</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>ipcs
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>IPC status from &lt;running system&gt; as of Wed May 24 10:44:34 EDT 2017
T     ID     KEY        MODE       OWNER    GROUP
Message Queues:

T     ID     KEY        MODE       OWNER    GROUP
Shared Memory:
m  65536 0x52020016 --rw-------     root    wheel
m 983041 0x0000162e --rw-rw-rw-   ahagen    staff

T     ID     KEY        MODE       OWNER    GROUP
Semaphores:

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and to remove it, find the <code>KEY</code> corresponding to it and use <code>ipcrm</code>.  Note that the KEY is usually the hexadecimal representation of the <code>key</code> you used in <code>c++</code>, so you can just use that:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">!</span>ipcrm -M <span class="m">5678</span>
</pre></div>

</div>
</div>
</div>

</div>
 


<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ah_value---Stateful-Variables">ah_value - Stateful Variables<a class="anchor-link" href="#ah_value---Stateful-Variables">&#182;</a></h3><p>The <code>ah_value</code> class is a simple, encapsulated c++ class to help track values.  It is written with the signal-slot paradigm so that events can be triggered as the values change.  This is a way to decrease the overhead that must happen to trace some values (such as checking if something is over a certain value every loop).</p>
<h4 id="Usage">Usage<a class="anchor-link" href="#Usage">&#182;</a></h4><p>Lets say we want to create a program that indicates whether a motor is up to speed, and thereafter, how much it has varied from that speed.  First, we need some sort of notifier class.  This class holds the value object, and also the notifier (duh) method, that will ring back and tell us when the alarm goes off.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">cppm</span> <span class="kn">import</span> <span class="n">cppmagic</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">include</span> notifier
#include &quot;../common/sigslot.h&quot;
#include &quot;../ah_value.h&quot;
#include &lt;stdio.h&gt;

class notifier : public sigslot::has_slots&lt;&gt;{
// we have to make this a sigslot so that it can accept slots
public:
    // a value object for our notifier class
    value&lt;int&gt; *vl;
    // a constructor to pass in an external notifier class
    notifier(value&lt;int&gt;*);
    // we need a slot that will tell when it&#39;s up to speed
    void up_to_speed(void);
};

notifier::notifier(value&lt;int&gt; *_vl){
    vl = _vl;
}

void notifier::up_to_speed(void){
    // let us know that we&#39;re up to speed
    printf(&quot;Motor is up to speed\n&quot;);
    // now reset the max min so we only get the maximum and minimum when up to
    // speed
    vl-&gt;resetmaxmin();
}
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a great example for using a custom compiler with the <code>cppmagics</code> class.  Below we'll  add the <code>-Wall</code> option.  I don't think this is necessary, but it'll work and it's informative.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">set_compiler</span> g++ --std=c++11 -Wall
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we need to write the main.  We create our value and instantiate our notifier.  We'll use the wonderful <code>sigslot.h</code> from Sarah Thomson (which I believe has no license, but if it does, tell me and I'll comply), to connect the <code>up_to_speed</code> method/slot to when the <code>abovelevel</code> signal is tripped.  Finally, we'll make up some data, and then look at the max and min of the data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%%</span><span class="k">runcpp</span> test_value
#include &quot;../ah_value.h&quot;
#include &quot;notifier.h&quot;

int main(void){
    // we need to create a new value class of type int
    value&lt;int&gt; *vl = new value&lt;int&gt;();
    // we need to create a new notifier class and pass in our value
    notifier *ntfr = new notifier(vl);
    // we need to connect the signal for above level to the slot telling us
    // we&#39;re up to speed
    vl-&gt;abovelevel.connect(ntfr, &amp;notifier::up_to_speed);
    // now we have to set what level we&#39;re up to speed at
    vl-&gt;setlevel(5);
    // now we want to slowly increase the speed
    vl-&gt;set(0);
    vl-&gt;set(1);
    vl-&gt;set(3);
    vl-&gt;set(5);
    vl-&gt;set(7);
    vl-&gt;set(9);
    vl-&gt;set(7);
    vl-&gt;set(5);
    // now that we&#39;re back below speed (remember we said *above* 5), we can end
    // and look at details
    printf(&quot;The maximum when up to speed was %d, and the minimum was %d.&quot;, \
        vl-&gt;getmax(),vl-&gt;getmin());

    return 0;
}
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Motor is up to speed
The maximum when up to speed was 9, and the minimum was 5.
</pre>
</div>
</div>

</div>
</div>

</div>
 

</div>
<div class="section" id="tcp-objects">
<h2>TCP Objects<a class="headerlink" href="#tcp-objects" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="udp-objects">
<h2>UDP Objects<a class="headerlink" href="#udp-objects" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="signals-and-timing">
<h2>Signals and Timing<a class="headerlink" href="#signals-and-timing" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="ah_shm.html">ah_shm Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ah_value.html">ah_value Documentation</a></li>
</ul>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Alex Hagen.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>